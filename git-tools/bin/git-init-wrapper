#!/bin/bash
# shellcheck disable=2153

set -eo pipefail

HOOKS=
GIT_DIR=

usage() {
    echo "git-init-wrapper"
    echo
    echo "Usage: git init-wrapper [args]"
    echo
    echo "Args:"
    echo "--dir,   -d   If provided, the directory in which git will be initiated."
    echo "--help,  -h   Help."
    echo "--hooks, -t   Comma-separated string of directory names that hold the"
    echo "              hooks to be installed."
}

if [ "$#" -gt 0 ]; then
    while [ "$#" -gt 0 ]; do
        OPT="$1"
        case "$OPT" in
            --dir|-d) shift; GIT_DIR="$1" ;;
            --hooks|-t) shift; HOOKS="$1" ;;
            --help|-h) usage; exit 0 ;;
            *) echo "[ERROR] Unrecognized option \`$OPT\`."; usage; exit 1 ;;
        esac
        shift
    done
fi

PROJECT_DIR="${GIT_DIR:-$(pwd)}"
if [ ! -d "$PROJECT_DIR" ]
then
    mkdir -p "$PROJECT_DIR"
fi

git init "$PROJECT_DIR"
git bootstrap --dir "$PROJECT_DIR"

if [ -n "$HOOKS" ]
then
    # `git-hooks` expects to be run from the root of the project dir.
    pushd "$PROJECT_DIR" > /dev/null
    git hooks --type "$HOOKS"
    popd > /dev/null
else
    echo "[INFO] No git hooks installed."
fi

